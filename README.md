
# Prescription Ordering Bot

This project is a simple prescription ordering bot that automates the process of checking when prescriptions are due, logging onto the patient-services GP platform and posting the request for any that needed ordered. It sends a notification via Telegram to advise when this has been done, then sets a reminder on Google Calendar of when they can be collected.

Ordering prescriptions on the website at different times of the month and setting reminders is a boring manual process, and easy to forget - if your GP surgery uses patient-services, feel free to use/adapt this. It works perfectly for me, but some alteration may be required to tailor it to you.

I haven't built it into a "proper" release as I don't know anyone else who could benefit from it apart from myself.

- **Q** - Why not just put it on repeat at the surgery and get them to sort it every month?
- **A** -  Because they always mess it up, so ordering as ad-hoc is the only way to make sure it actually gets done

## Functionality

- **Date Calculations**: The bot calculates due dates for prescriptions based on the last ordered date and frequency.
- **Notifications**: The bot sends notifications via Telegram when prescriptions have been ordered
- **Ordering**: The bot logs into the patient services website and sends a POST request to order the prescriptions.
- **Calendar update**: The bot updates Google Calendar with the date of when the prescriptions can be collected

## Key Files and Directories

- data: Contains environment variables and prescription data.
  - `.env`: Environment variables for the project.
  - `token.json`: OAuth credentials for calendar access.
  - `token.pickle`: generated by app on first run
  - `prescriptions.json`: JSON file containing prescription data.
- log: Contains log files.
  - `bot.log`: Log file for the bot's operations.
- order_prescriptions.py: Main script to start the bot.
- requirements.txt: Lists the dependencies required for the project.
- src: Contains the source code for the bot.
  - bot.py: Main bot logic.
  - ordering.py: Functions related to ordering prescriptions.
  - `telegram.py`: Functions to send notifications via Telegram.
- tests: Contains unit tests for the project.
  - `test_dates.py`: Unit tests for date calculations.
- venv: virtual environment

## Usage

The bot is intended to be run every day, so I have set it up as a cron job on my Raspberry Pi. If nothing is due to be ordered it exits, only taking action when things are due to be ordered.

## Required data

The data/ folder should contain the following:

### prescriptions.json

```json
[
  {
    "name": "Example med",
    "dose": "500mg",
    "last_ordered_date": "2024-12-07",
    "frequency": 28
  },
]
```

### .env

- USERNAME: the patient-services username
- PASSWORD: the patient-services password
- TELEGRAM_ID: the telegram chat ID to send notifications to
- TELEGRAM_API_KEY: the telegram API key
- GMAIL_USERNAME: the gmail username for the calendar events

### token.json

- this is generated by the Google API account page

### token.pickle

- this is generated by the app on first run - a google link will be printed to the screen
